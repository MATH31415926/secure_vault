# Secure Vault

跨平台加密文件存储应用，支持块级去重。

## 安全架构

### 加密
- **算法**: XSalsa20-Poly1305 (通过 libsodium/PyNaCl)
- **密钥长度**: 256 位主密钥
- **块大小**: 每个加密块 4 MB
- **块级密钥派生**: 每个块使用唯一的随机盐值，实际加密密钥通过 `BLAKE2b(主密钥 + 盐值)` 派生。这确保即使使用同一主密钥加密的块也具有完全不同的密文，防止模式分析攻击。
- **元数据**: 文件名和注释使用主密钥加密

### 密钥管理
- **PIN 保护**: 主密钥使用 Argon2id 从用户 PIN 派生的密钥加密
- **密钥派生**: Argon2id，MODERATE 成本参数
- **验证**: 存储主密钥的 BLAKE2b 哈希 (32 字节) 用于验证
- **块密钥**: 每个块使用唯一盐值配合 BLAKE2b 派生独立密钥

### 存储
- **去重**: 基于 BLAKE2b 文件哈希的内容寻址存储
- **懒加载**: 目录内容按需加载，支持上亿级文件规模
- **数据库**: 每个仓库独立的 SQLite 数据库，存储加密元数据

## 环境要求

```
Python >= 3.10
PyQt6
PyNaCl
```

## 安装

```bash
git clone <repository>
cd secure_vault
pip install -r requirements.txt
python main.py
```

## 使用方法

### 初始设置
1. 启动应用 → 设置 PIN 码（至少 4 位）
2. 配置主密钥：
   - **随机生成**: 自动生成 256 位密钥（推荐）
   - **手动输入**: 输入 64 字符十六进制字符串
3. 创建仓库 → 选择文件夹并设置容量限制

### 日常使用
1. 输入 PIN 解密主密钥
2. 选择仓库
3. 拖放文件导入（自动加密）
4. 右键菜单：导出、重命名、删除、添加注释

### 功能说明
- **导入**: 拖放文件/文件夹 → 分割为 4MB 块 → 加密 → 去重存储
- **导出**: 选择文件 → 解密块 → 重组原始文件
- **多仓库**: 每个仓库拥有独立的数据库和块存储

## 文件结构

```
repository/
├── .vault/
│   ├── database.db      # 加密的文件元数据
│   ├── blocks/          # 加密的 4MB 数据块
│   │   ├── 00/          # 基于哈希的子目录
│   │   ├── 01/
│   │   └── ...
│   └── config.json      # 仓库配置文件
```

## 许可证

MIT
